[CmdletBinding()]
param()

Set-StrictMode -Version Latest
$ErrorActionPreference = 'Continue'

$issues = 0
function Check { param([string]$Name,[bool]$Pass,[string]$Detail)
    $prefix = if ($Pass) { '[PASS]' } else { '[FAIL]' }
    Write-Host "$prefix $Name" -ForegroundColor (if ($Pass) { 'Green' } else { 'Red' })
    if ($Detail) { Write-Host "       $Detail" -ForegroundColor Gray }
    if (-not $Pass) { $script:issues++ }
}

Write-Host 'Microsoft Defender Vulnerability Management - Prerequisites' -ForegroundColor Cyan
Check 'Defender for Endpoint sensor service is present' ([bool](Get-Service -Name Sense -ErrorAction SilentlyContinue)) 'Required for TVM data ingestion'
Check 'PowerShell 5+' ($PSVersionTable.PSVersion.Major -ge 5) $PSVersionTable.PSVersion.ToString()

if ($issues -gt 0) { exit 1 }
