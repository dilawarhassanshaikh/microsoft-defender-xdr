[CmdletBinding(SupportsShouldProcess)]
param(
    [string]$ExportPath = '.\\mdvm-baseline.json'
)

Set-StrictMode -Version Latest
$ErrorActionPreference = 'Stop'

& "$PSScriptRoot/../prerequisites/Test-MDVMPrerequisites.ps1"

$baseline = [ordered]@{
    generatedAt = (Get-Date).ToString('o')
    recommendations = @(
        @{ id = 'TVM-001'; title = 'Enable tamper protection'; priority = 'High' },
        @{ id = 'TVM-002'; title = 'Update vulnerable software'; priority = 'High' },
        @{ id = 'TVM-003'; title = 'Enable attack surface reduction rules'; priority = 'Medium' }
    )
}

if ($PSCmdlet.ShouldProcess($ExportPath, 'Export baseline MDVM recommendations')) {
    $baseline | ConvertTo-Json -Depth 5 | Set-Content -Path $ExportPath -Encoding UTF8
    Write-Host "Baseline recommendations exported to $ExportPath" -ForegroundColor Green
}
