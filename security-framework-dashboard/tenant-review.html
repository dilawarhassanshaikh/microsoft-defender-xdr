<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tenant Compliance Review | Security Framework Dashboard</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* Page-specific styles for the review page */
    .review-hero {
      padding: var(--space-xl);
      background: linear-gradient(135deg, rgba(76,194,255,0.06) 0%, rgba(123,141,255,0.04) 100%);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-xl);
      margin-bottom: var(--space-xl);
    }

    .review-hero h1 {
      font-size: var(--font-size-xl);
      font-weight: 700;
      margin-bottom: var(--space-sm);
    }

    .review-hero p {
      color: var(--color-text-secondary);
      line-height: 1.7;
    }

    .tenant-details-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--space-lg);
      margin-bottom: var(--space-xl);
    }

    .detail-card {
      padding: var(--space-lg);
      background: var(--color-surface-card);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
    }

    .detail-card h3 {
      font-size: var(--font-size-sm);
      font-weight: 600;
      color: var(--color-text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: var(--space-md);
    }

    .detail-value {
      font-size: var(--font-size-lg);
      font-weight: 700;
      color: var(--color-text-primary);
      margin-bottom: var(--space-xs);
    }

    .detail-sub {
      font-size: var(--font-size-sm);
      color: var(--color-text-tertiary);
    }

    .checklist {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .checklist li {
      display: flex;
      align-items: flex-start;
      gap: var(--space-sm);
      padding: var(--space-md);
      background: var(--color-surface);
      border-radius: var(--radius-md);
      border: 1px solid var(--color-border);
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
      line-height: 1.6;
    }

    .checklist .check-icon {
      flex-shrink: 0;
      width: 20px;
      height: 20px;
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      margin-top: 2px;
    }

    .check-icon--pass { background: var(--color-success-bg); color: var(--color-success); }
    .check-icon--fail { background: var(--color-danger-bg); color: var(--color-danger); }
    .check-icon--warn { background: var(--color-warning-bg); color: var(--color-warning); }
    .check-icon--info { background: var(--color-info-bg); color: var(--color-brand-primary); }

    .timeline {
      position: relative;
      padding-left: var(--space-xl);
    }

    .timeline::before {
      content: '';
      position: absolute;
      left: 10px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: var(--color-border);
    }

    .timeline-item {
      position: relative;
      padding: var(--space-md);
      margin-bottom: var(--space-md);
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
    }

    .timeline-item::before {
      content: '';
      position: absolute;
      left: calc(-1 * var(--space-xl) + 6px);
      top: var(--space-md);
      width: 10px;
      height: 10px;
      border-radius: var(--radius-full);
      background: var(--color-brand-primary);
      border: 2px solid var(--color-surface-card);
    }

    .timeline-date {
      font-size: var(--font-size-xs);
      color: var(--color-text-tertiary);
      margin-bottom: var(--space-xs);
    }

    .timeline-title {
      font-size: var(--font-size-sm);
      font-weight: 600;
      color: var(--color-text-primary);
      margin-bottom: var(--space-xs);
    }

    .timeline-body {
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
    }

    .export-bar {
      display: flex;
      gap: var(--space-sm);
      margin-bottom: var(--space-xl);
    }
  </style>
</head>
<body>
  <nav class="top-nav" role="navigation" aria-label="Primary navigation">
    <div class="nav-brand">
      <svg class="nav-logo" width="20" height="20" viewBox="0 0 23 23" fill="none" aria-hidden="true">
        <rect width="11" height="11" fill="#f25022"/><rect x="12" width="11" height="11" fill="#7fba00"/>
        <rect y="12" width="11" height="11" fill="#00a4ef"/><rect x="12" y="12" width="11" height="11" fill="#ffb900"/>
      </svg>
      <span class="nav-title">Microsoft Defender XDR</span>
      <span class="nav-separator">|</span>
      <span class="nav-subtitle">Tenant Review</span>
    </div>
  </nav>

  <main class="main-content">
    <div class="page-header">
      <a href="index.html" class="back-link">&larr; Back to Dashboard</a>
    </div>

    <section class="review-hero">
      <h1>Tenant Compliance Review</h1>
      <p>This page provides an overview of how administrators can connect their Microsoft 365 tenant and review security framework compliance. Follow the checklist below to ensure your environment is properly configured for evaluation against ISO 27001, CIS Controls, and NIST CSF.</p>
    </section>

    <!-- Export / Actions Bar -->
    <div class="export-bar">
      <button class="btn btn-secondary" onclick="window.print()">Export as PDF</button>
      <button class="btn btn-secondary" onclick="alert('CSV export would generate a file with all control mappings and their compliance status.')">Export as CSV</button>
      <a href="index.html" class="btn btn-primary">Open Dashboard</a>
    </div>

    <!-- Tenant Details -->
    <h2 class="section-title">Tenant Configuration</h2>
    <div class="tenant-details-grid">
      <div class="detail-card">
        <h3>Tenant Information</h3>
        <div class="detail-value" id="review-tenant-name">Not Connected</div>
        <div class="detail-sub" id="review-tenant-id">Connect a tenant from the main dashboard</div>
      </div>
      <div class="detail-card">
        <h3>Authentication Method</h3>
        <div class="detail-value" id="review-auth-method">—</div>
        <div class="detail-sub">Method used to query Microsoft Graph API</div>
      </div>
      <div class="detail-card">
        <h3>Frameworks Evaluated</h3>
        <div class="detail-value" id="review-frameworks">—</div>
        <div class="detail-sub">Selected security frameworks for compliance mapping</div>
      </div>
      <div class="detail-card">
        <h3>Last Assessment</h3>
        <div class="detail-value" id="review-last-assessment">—</div>
        <div class="detail-sub">Most recent compliance evaluation timestamp</div>
      </div>
    </div>

    <!-- Pre-Connection Checklist -->
    <h2 class="section-title">Pre-Connection Checklist</h2>
    <ul class="checklist">
      <li>
        <span class="check-icon check-icon--info">1</span>
        <div>
          <strong>Azure AD / Entra ID App Registration</strong><br/>
          Register an application in the Azure portal under <strong>App registrations</strong>. Record the Application (Client) ID and the Directory (Tenant) ID. These are required for service principal authentication.
        </div>
      </li>
      <li>
        <span class="check-icon check-icon--info">2</span>
        <div>
          <strong>API Permissions — Microsoft Graph</strong><br/>
          Add the following <strong>Application permissions</strong> to your app registration:
          <code>SecurityEvents.Read.All</code>,
          <code>DeviceManagementConfiguration.Read.All</code>,
          <code>Policy.Read.All</code>,
          <code>Directory.Read.All</code>.
          These grant read-only access to security events, device configuration, policies, and directory data.
        </div>
      </li>
      <li>
        <span class="check-icon check-icon--warn">3</span>
        <div>
          <strong>Admin Consent</strong><br/>
          A <strong>Global Administrator</strong> must grant tenant-wide admin consent for the requested permissions. Without consent, the dashboard cannot retrieve compliance data. Navigate to <em>API Permissions &rarr; Grant admin consent for [tenant]</em>.
        </div>
      </li>
      <li>
        <span class="check-icon check-icon--info">4</span>
        <div>
          <strong>Client Secret or Certificate</strong><br/>
          For service principal authentication, create a client secret or upload a certificate under <strong>Certificates &amp; secrets</strong>. Store the secret securely — it is shown only once.
        </div>
      </li>
      <li>
        <span class="check-icon check-icon--pass">5</span>
        <div>
          <strong>Defender Products Onboarded</strong><br/>
          Ensure the following Defender products are onboarded in your tenant for comprehensive coverage:
          <ul style="margin-top:8px;padding-left:20px;list-style:disc">
            <li>Microsoft Defender for Endpoint (MDE)</li>
            <li>Microsoft Defender for Identity (MDI)</li>
            <li>Microsoft Defender for Office 365 (MDO)</li>
            <li>Microsoft Defender for Cloud Apps (MDCA)</li>
            <li>Microsoft Defender Vulnerability Management (MDVM)</li>
          </ul>
        </div>
      </li>
      <li>
        <span class="check-icon check-icon--pass">6</span>
        <div>
          <strong>Connect via Dashboard</strong><br/>
          On the main dashboard, click <strong>Connect Tenant</strong>, enter your Tenant ID (GUID or .onmicrosoft.com domain), select your authentication method, and choose which frameworks to evaluate. The dashboard queries Microsoft Graph to pull your Defender configuration and maps it against the selected frameworks.
        </div>
      </li>
    </ul>

    <!-- What Gets Evaluated -->
    <h2 class="section-title" style="margin-top:var(--space-xl)">What Gets Evaluated</h2>
    <div class="review-grid">
      <div class="review-card">
        <div class="review-card-header">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" class="review-icon" aria-hidden="true">
            <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
          </svg>
          <h3>Defender for Endpoint</h3>
        </div>
        <ul class="review-list">
          <li class="review-item--pass">EDR sensor deployment status</li>
          <li class="review-item--pass">Attack Surface Reduction rule configuration</li>
          <li class="review-item--info">Network Protection and Web Content Filtering policies</li>
          <li class="review-item--pass">Controlled Folder Access settings</li>
          <li class="review-item--pass">Automated Investigation &amp; Remediation configuration</li>
        </ul>
      </div>

      <div class="review-card">
        <div class="review-card-header">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" class="review-icon" aria-hidden="true">
            <path d="M10 2a6 6 0 100 12 6 6 0 000-12zm0 2a1.5 1.5 0 110 3 1.5 1.5 0 010-3zm0 10c-2 0-3.75-.94-4.87-2.4C6.38 10.13 8.14 9.5 10 9.5s3.63.63 4.87 2.1C13.75 13.06 12 14 10 14z"/>
          </svg>
          <h3>Defender for Identity</h3>
        </div>
        <ul class="review-list">
          <li class="review-item--pass">Domain Controller sensor installation status</li>
          <li class="review-item--pass">gMSA account configuration</li>
          <li class="review-item--warn">Active Directory security posture assessment</li>
          <li class="review-item--pass">Lateral movement path detection configuration</li>
        </ul>
      </div>

      <div class="review-card">
        <div class="review-card-header">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" class="review-icon" aria-hidden="true">
            <path d="M2.003 5.884L10 1.69l7.997 4.194A1 1 0 0118.5 7H1.5a1 1 0 01-.497-1.116zM18 17H2v-2h16v2zM3 14V8h2v6H3zm4 0V8h2v6H7zm4 0V8h2v6h-2zm4 0V8h2v6h-2z"/>
          </svg>
          <h3>Defender for Office 365</h3>
        </div>
        <ul class="review-list">
          <li class="review-item--pass">Safe Attachments policy status</li>
          <li class="review-item--pass">Safe Links policy configuration</li>
          <li class="review-item--warn">Anti-phishing policy strength</li>
          <li class="review-item--fail">DMARC/DKIM/SPF record validation</li>
        </ul>
      </div>

      <div class="review-card">
        <div class="review-card-header">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" class="review-icon" aria-hidden="true">
            <path d="M5.5 16a3.5 3.5 0 01-.369-6.98 6 6 0 0111.738 0A3.5 3.5 0 0116.5 16h-11z"/>
          </svg>
          <h3>Defender for Cloud Apps</h3>
        </div>
        <ul class="review-list">
          <li class="review-item--pass">Cloud Discovery (Shadow IT) status</li>
          <li class="review-item--warn">App Governance policy configuration</li>
          <li class="review-item--warn">Conditional Access App Control (session policies)</li>
          <li class="review-item--pass">OAuth app consent monitoring</li>
        </ul>
      </div>

      <div class="review-card">
        <div class="review-card-header">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" class="review-icon" aria-hidden="true">
            <path d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v3.586l-1.707 1.707a1 1 0 101.414 1.414l2-2A1 1 0 0011 10V7z"/>
          </svg>
          <h3>Vulnerability Management</h3>
        </div>
        <ul class="review-list">
          <li class="review-item--pass">Vulnerability assessment scan coverage</li>
          <li class="review-item--warn">Security baseline compliance percentage</li>
          <li class="review-item--pass">Software inventory completeness</li>
          <li class="review-item--fail">Browser extension risk assessment</li>
        </ul>
      </div>

      <div class="review-card">
        <div class="review-card-header">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" class="review-icon" aria-hidden="true">
            <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 6a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2zm0 6a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z"/>
          </svg>
          <h3>XDR Portal</h3>
        </div>
        <ul class="review-list">
          <li class="review-item--pass">Unified incident queue configuration</li>
          <li class="review-item--pass">Advanced Hunting availability</li>
          <li class="review-item--pass">Automated IR rules</li>
          <li class="review-item--warn">Secure Score current vs. target</li>
          <li class="review-item--pass">RBAC role assignment audit</li>
          <li class="review-item--fail">DLP integration status</li>
        </ul>
      </div>
    </div>

    <!-- Assessment Timeline -->
    <h2 class="section-title" style="margin-top:var(--space-xl)">Assessment Timeline</h2>
    <div class="timeline">
      <div class="timeline-item">
        <div class="timeline-date">Step 1 — Tenant Connection</div>
        <div class="timeline-title">Authenticate and Establish Graph Session</div>
        <div class="timeline-body">The dashboard authenticates to Microsoft Graph using the chosen method (interactive, service principal, or managed identity) and retrieves tenant metadata.</div>
      </div>
      <div class="timeline-item">
        <div class="timeline-date">Step 2 — Data Collection</div>
        <div class="timeline-title">Query Defender Configuration via Graph API</div>
        <div class="timeline-body">Reads security policies, device configurations, incident response settings, and vulnerability data from the Security, DeviceManagement, and Identity Graph endpoints.</div>
      </div>
      <div class="timeline-item">
        <div class="timeline-date">Step 3 — Framework Mapping</div>
        <div class="timeline-title">Map Configuration to Control Requirements</div>
        <div class="timeline-body">Each Defender capability is evaluated against the selected framework controls (ISO 27001 Annex A, CIS Safeguards, NIST CSF subcategories) and assigned a compliance status: Compliant, Partial, or Non-Compliant.</div>
      </div>
      <div class="timeline-item">
        <div class="timeline-date">Step 4 — Scoring</div>
        <div class="timeline-title">Calculate Compliance Scores</div>
        <div class="timeline-body">Overall and per-framework scores are calculated. Compliant controls score 100%, Partial controls score 50%, and Non-Compliant controls score 0%. Scores are weighted equally across all mapped controls.</div>
      </div>
      <div class="timeline-item">
        <div class="timeline-date">Step 5 — Review &amp; Remediate</div>
        <div class="timeline-title">Generate Recommendations and Remediation Actions</div>
        <div class="timeline-body">Non-compliant and partially compliant controls generate actionable recommendations. Admins can use the PowerShell scripts in this repository to remediate findings directly.</div>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    <p>Tenant Compliance Review &mdash; Microsoft Defender XDR Security Framework Dashboard</p>
  </footer>

  <script>
    // Load tenant state from localStorage
    (function() {
      try {
        var saved = localStorage.getItem("xdr-tenant");
        if (saved) {
          var state = JSON.parse(saved);
          if (state.connected) {
            document.getElementById("review-tenant-name").textContent = state.tenantName || "Unknown";
            document.getElementById("review-tenant-id").textContent = "Tenant ID: " + state.tenantId;
            var methods = { "interactive": "Interactive (Browser Sign-In)", "service-principal": "Service Principal", "managed-identity": "Managed Identity" };
            document.getElementById("review-auth-method").textContent = methods[state.authMethod] || state.authMethod;
            var fws = [];
            if (state.frameworks.iso27001) fws.push("ISO 27001");
            if (state.frameworks.cis) fws.push("CIS v8");
            if (state.frameworks.nist) fws.push("NIST CSF");
            document.getElementById("review-frameworks").textContent = fws.join(", ") || "None";
            if (state.lastAssessment) {
              document.getElementById("review-last-assessment").textContent = new Date(state.lastAssessment).toLocaleDateString("en-GB", { day:"numeric", month:"short", year:"numeric", hour:"2-digit", minute:"2-digit" });
            }
          }
        }
      } catch(_) {}
    })();
  </script>
</body>
</html>
